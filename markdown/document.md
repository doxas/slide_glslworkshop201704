
#### 自己紹介

名前：杉本 雅広（すぎもと まさひろ）

運営中： <a href="https://wgld.org/" target="_blank">wgld.org</a>, <a href="https://webgl.souhonzan.org/" target="_blank">WebGL 総本山</a>

<a target="_blank" href="https://twitter.com/h_doxas">@h_doxas | Twitter</a>

![doxas](sample.png)

---

#### GLSL ワークショップ要旨

* シェーダってどんなものか知ろう
* 初めてでも気軽に挑戦できるシェーダの世界
* セミナーを通じて感じるハイレベルな実装例
* みんなで挑戦シェーダアート
* フロントエンドにもっと高い表現力を！

---

#### GLSL 基礎講座

ウェブの世界に WebGL が登場し、ずいぶん経ちました。

既に、世界レベルで見ればウェブ界隈にもシェーダを用いた高い表現力が求められるケースは増えています。さらには、Unity などのゲームエンジンに代表される 3D コンテンツを作ることのできるソリューションの登場で、静かに、しかし確かに活気づいてきているのがシェーダテクニックのジャンルです。

---

#### GLSL 基礎講座

GLSL ワークショップのオープニングは、そんな注目が集まりつつある GLSL の基礎講座からスタートです。

午後からは、GLSL を使いこなすプロのテクニックを学ぶことができるセミナーもあります。

今日という一日が、ここにいるみなさんにとっての有意義なシェーダと向き合うきっかけやモチベーションになってくれたとしたら、主催者としてとてもうれしいです。

---

#### GLSL 基礎講座

ちなみに今回のイベントの告知の際に、申込みと同時にアンケートを実施しみなさんに回答をお願いしました。

覚えていますでしょうか。

それを集計した結果がこれです。

---

#### GLSL 基礎講座

![](glsl.jpg)

---

#### GLSL 基礎講座

かなりきれいに分布が別れたかな？ と個人的には思いました。

今日がシェーダ初挑戦、という人でもスムーズに取り組むことができるように、まずは GLSL の基本的な知識から始めていきましょう。既にそういった基礎知識をお持ちのみなさんは、再確認の意味でお聞きいただければと思います。

---

#### GLSL 基礎講座

ただしあえて先に書いておくと、今回は、あくまでも *理解のしやすさを重視* した基礎講座になっています。

厳密な GLSL の仕様や、GPU のアーキテクチャには触れません。特にシェーダに不慣れなうちは、難しく考えるとどこまででも無限に難しくできるジャンルですので、なによりもまずは *楽しくシェーダにトライできる状態* を真っ先に作ってしまう、ということが大事です。

<span class="capt">深いことは自分で調べて身につけるのが一番！（投げやり）</span>

---

#### 

---

#### シェーダ記述言語 GLSL

3DCG 描画のための API には、主に Windows を搭載した PC で使われている DirectX 系と、オープンソースでクロスプラットフォームな OpenGL があります。

これらはたぶん、ここにいらっしゃるみなさんは目にしたり、話を聞いたりしたことがあると思います。

GLSL は、上記二者のうち、OpenGL のファミリーに属しています。

---

#### シェーダ記述言語 GLSL

OpenGL 用の Shader Language なので、これを略して GLSL と呼ばれています。対応する OpenGL のバージョンが変わると、GLSL も変更を受ける場合がほとんどですので、利用している GL 系のバージョンによって、GLSL もそれに合わせたものを使ってやる必要があります。

今日は WebGL を使いますので、この WebGL に対応した GLSL のバージョンとして *GLSL ES 1.0* を使います。

参考：<a href="https://www.khronos.org/files/webgl/webgl-reference-card-1_0.pdf" target="_blank">webgl reference card</a> （PDF）

<span class="capt">このチートシートに関数の一覧などが掲載されています。</span>

---

#### シェーダ記述言語 GLSL

GLSL は、例えて言うなら *GPU 専用のプログラミング言語* です。JavaScript は主にブラウザなどで動作する言語ですが、GLSL は、GPU と呼ばれるグラフィックス生成工場の中枢で動作するプログラミング言語なんですね。

GPU は並列処理により高速に演算処理を行うことができるので、GLSL の書き方ひとつで、驚くようなグラフィックスをスクリーンに描き出すことができます。

---

#### フロントエンド風 GLSL 解説

GLSL やシェーダといった概念は、最初はどうしても難しいです。これは事実です。

でも、考え方ひとつ、捉え方ひとつで、実際には驚くほど気軽に書くことができます。今回は、フロントエンドになぞらえてシェーダについて解説してみます。

<span class="capt">身構えずに気軽な気持ちで聞いてね！</span>

---

#### フロントエンド風 GLSL 解説

ウェブページを構成する要素には、HTML と CSS、そして JavaScript などがあります。WebGL や GLSL を考える場合には HTML と CSS に例えてみるとイメージがしやすいのではないかなと思います。

というのも、WebGL や GLSL を使いこなすうえでの考え方は、HTML と CSS がそれぞれに連携しているのと同じように *複数の概念が組み合わさったような構成* になっているからです。

---

#### フロントエンド風 GLSL 解説

たとえば HTML は文章によってコンテンツの構造や意味を記述します。そしてそこに、CSS が色や形を与えますね。これらは密接に関係していますが、それぞれに役割が異なっており、フロントエンドエンジニアであればそのあたりは日頃から常々考えていることだと思います。

GLSL にも、これと似たようなことが言える部分があります。

<span class="capt">どういうことなの！？</span>

---

#### フロントエンド風 GLSL 解説

WebGL を用いた開発では、GLSL を使って二種類のシェーダを記述します。

これらは **頂点シェーダ** と **フラグメントシェーダ** と呼ばれています。

これに、JavaScript などで記述された **アプリケーション本体** が加わり、これらが連携することによって様々なグラフィックスを描画します。

---

#### フロントエンド風 GLSL 解説

![](001.jpg)

---

#### フロントエンド風 GLSL 解説

JavaScript などの CPU 上で動作するアプリケーション本体は、言うなれば HTML のようなものです。

データの構造や、振る舞いの定義、それらの全体の制御などを行うのがアプリケーションの役割です。言い方を変えると、アプリケーションはあくまでもロジックや定義の集合体であって、直接的な外見との関係はシェーダに比べると疎です。

---

#### フロントエンド風 GLSL 解説

![](002.jpg)

---

#### フロントエンド風 GLSL 解説

そして、頂点シェーダは CSS で言うところの `display` や `position` や `width`、`height` に相当する部分を担当します。

つまり「どこに表示するか」とか「どんな大きさで描く」とか、そういうことを制御するのが頂点シェーダの役割です。

---

#### フロントエンド風 GLSL 解説

一方でフラグメントシェーダは、CSS なら `background-color` や `color`、`opacity` などに相当すると言えるでしょう。

「どんな色を表示するか」といったような、見た目に大きく影響してくる処理を行うのがフラグメントシェーダの役割です。

---

#### フロントエンド風 GLSL 解説

![](003.jpg)

---

#### フロントエンド風 GLSL 解説

* HTML は構造や意味を定義 ≒ WebGL のロジックや定義
* CSS の `position` や `width` ≒ 頂点シェーダ（形や大きさ）
* CSS の `color` や `opacity` ≒ フラグメントシェーダ（色）

<span class="capt">意外と似てる？ (こじつけ感漂う……)</span>

---

#### 役割を把握しておく

このように、GLSL を用いたシェーダコーディングを手っ取り早く理解するためには、それぞれの役割についてしっかり把握しておくことが近道になります。

頂点シェーダは「形や大きさ」を制御し、どの場所に、どんな形で、どんな大きさで描くのか、といったことを決めます。フラグメントシェーダは、頂点シェーダが決めた「オブジェクトを描くべきスクリーン上のピクセル」に色を塗ってくれるわけですね。

これがとても大事な、シェーダのそれぞれの役割の違いです。確実にテストに出るレベルです。

<span class="capt">テストはやりませんけど！</span>

---

#### 

---

#### オンライン GLSL エディタ

ここからはハンズオン形式で、GLSL を実際に触っていきましょう。

習うより慣れろ！ これです。スパルタです。

手前味噌で恐縮ですが、私が実装したオンラインで GLSL を記述することができるエディタがありますので、そちらを使いましょう。

<a href="https://doxas.org/work/glsl_editor/" target="_blank">GLSL editor</a>(https://doxas.org/work/glsl_editor/)

---

#### オンライン GLSL エディタの使い方

* Windows なら Ctrl + s、Mac なら Command + s で実行
* Esc キーで停止（放置危険ｗ
* URL に GLSL のコードを全展開する荒業式
* URL は短縮 URL に変換できるので簡単シェア！
* HTML ファイルとしてダウンロードも可能
* マウス座標も取れるよ

---

#### オンライン GLSL エディタの使い方

GLSL で **フラグメントシェーダ** を記述できる WebGL 製のエディタです。

先ほどの話を、しっかり思い出しましょう。このエディタはあくまでも「フラグメントシェーダ」を記述するためのものなので、色に関する処理を記述することに特化した実装になっています。

頂点シェーダなどについても扱ってもいいのですが、そうするとかなり本格的な話になってしまうので、まずはフラグメントシェーダの記述を通じて、シェーダに慣れていきましょう。

---

#### フラグメントシェーダ

フラグメントシェーダは、フラグメント（断片）の語からもわかるとおり、ある「小さな断片」をひとつひとつ処理することができるシェーダです。

さて、この小さな断片とはいったいなんのことを指しているのかわかるでしょうか。

<span class="capt">グラフィックスを構成する最小単位といえば？</span>

---

#### フラグメントシェーダ

この「小さな断片」とは、すなわち **スクリーン上のピクセルひとつひとつ** のことです。

つまり、描画する領域がフル HD のウィンドウ全体だとすると、1,920 x 1,080 = 2,073,600px となるので、約 207 万ピクセル上でフラグメントシェーダが実行されることになります。

これが毎秒 60 フレームとかで処理されているわけですから、GPU ってのはとんでもない野郎ですね。

---

#### フラグメントシェーダ

GLSL エディタは画面の左側の領域が 512px の正方形ですので、約 26 万ピクセルです。この、26 万という大量のピクセルを、フラグメントシェーダに記述した処理が駆け抜けていきます。1px 残らず *全てのピクセル* でエディタ上に記述したフラグメントシェーダが実行されます。

これが非常に大事なポイントです。

---

#### 色が塗られる仕組み

全てのピクセルで同じシェーダのコードが実行されるとしたら、どうやって多彩なグラフィックスを描いたらいいのでしょうか。

この感覚が最初に掴めてしまえば、驚くほどシェーダは楽しいツールになります。

頭を柔らかくしてイメージしながら考えてみてください。

---

#### 色が塗られる仕組み

非常に単純な例として、仮にスクリーンが 2px 四方の矩形だった場合を考えてみましょう。

![](004.jpg)

---

#### 色が塗られる仕組み

このとき、ピクセルの座標情報（インデックス）がシェーダ内で取得できるとします。

![](005.jpg)

---

#### 色が塗られる仕組み

シェーダ内で、このインデックスを見ながら、次のような単純なロジックを組んだとしたら、描画結果はどうなるでしょうか。

```
X の値を 2 で割った余りが 0 なら白、それ以外は黒に塗る
```

---

#### 色が塗られる仕組み

当たり前ですが、こうなりますね。

![](006.jpg)

---

#### 色が塗られる仕組み

さあ、もうわかりましたね？

要するに、座標のインデックス情報を元に、各ピクセルごとに異なる色が出力されるようなロジックを、フラグメントシェーダを使って記述する。これこそが、シェーダアートの基本です。

というか、**それが全て** です。

<span class="capt">冗談でもなんでもなく、ほんとにこれが全て！</span>

---

#### 最低限知っておきたいこと

さてさて、シェーダアートのざっくりとした概念がおぼろげに見えたと言っても、GLSL を自由に記述していくためにあと少しだけ基本を押さえておきましょう。

GLSL は構文は C 言語に近いですが、型の考え方などがちょっと一般的なプログラミング言語とは異なります。

---

#### 最低限知っておきたいこと

**float と int**

GLSL では、整数の値と浮動小数点の値は厳密に区別されます。たとえば `i = 1;` と書いたら、これは整数です。`f = 1.0;` なら浮動小数点数ですね。

人間から見ると同じ 1 という値ですが、GLSL ではまったくの別物として処理されるので気をつけましょう。

---

#### 最低限知っておきたいこと

**vec 系の型**

いわゆるベクトル。`vec2`、`vec3`、そして`vec4` がある。JavaScript で言うところの配列のようにデータを複数格納できる。

たとえばシェーダでは色を表現する RGBA は `vec4` 型のデータとして扱われる。

---

#### 最低限知っておきたいこと

**mat 系の型**

いわゆる行列。ベクトルと同様に `mat2` から `mat4` までがある。

行列はまあ、無理に使わなくてもなんとかなりますが、数学的に行列のメリットや扱い方がわかっているのであれば、座標変換などに行列をバシバシ定義して使っていくことも可能。

---

#### 最低限知っておきたいこと

**gl_FragColor**

最終的に画面に出てくる色。

つまりこのビルトイン変数（あらかじめ GLSL で定義されている変数）の型は `vec4` になっていて、ここに RGBA を出力すればいい。

---

#### 最低限知っておきたいこと

**gl_FragCoord**

今まさに処理されようとしているピクセルのインデックス。

このビルトイン変数の `gl_FragCoord.xy` を参照すれば、どのピクセルが処理されようとしているのかをシェーダ内で知ることができる。

---

#### 最低限知っておきたいこと

**スウィズル演算子**

`vec系` の変数の末尾に、JavaScript のメンバを参照するときのように使う。

ベクトルに対して使うことができ、`xyzw` や `rgba`、`stpq` などがあるがどれも意味はまったく同じ。

---

#### 最低限知っておきたいこと

**uniform 変数**

JavaScript（つまりアプリケーション）から毎フレーム送られてくるインタラクティブな値が入っている。

時間の経過やマウスカーソルの座標などは、JavaScript 側でしかわからないので、これをシェーダに送るために使われている。

---

#### 

---

#### GLSL シェーダアート参考サイト

* <a target="_blank" href="http://glslsandbox.com/">GLSL Sandbox Gallery</a> (超定番)
* <a target="_blank" href="https://www.shadertoy.com/">Shadertoy BETA</a> ( *高負荷超注意* )
* <a target="_blank" href="http://www.demoscene.jp/?p=1147">GLSLで簡単2Dエフェクト « demoscene.jp</a> (うれしい日本語)
* <a target="_blank" href="http://pixelshaders.com/">Pixel Shaders</a> (解説付きだけど英語)
* <a target="_blank" href="https://thebookofshaders.com/">The Book of Shaders</a> (有志による日本語訳も)
* <a target="_blank" href="https://wgld.org/d/glsl/">wgld.org | GLSL |</a> (著者はシェーダが好きらしいです)

---

#### 

---

#### 最後に

このワークショップは、初めてシェーダに挑戦する方でも気軽にシェーダに触れてみてほしい、という思いから企画しました。

基礎講座と言いつつも、やっぱり初めてでは戸惑うことも多かったと思います。午後からはセミナーなどもありますし、余った時間は自由にシェーダを書く時間として使うことができますので、ぜひ諦めずにトライしてみてください。

<span class="capt">シェーダは慣れです！</span>

---

#### 最後に

セミナーが終わったあとの空き時間は、みなさんには、ある程度シェーダを記述することに専念してもらいたいと思っていますが……それでも、基礎講座やセミナーの内容だけでは、なかなか GLSL 記述のコツが掴めないという方ももちろんいると思います。

セミナー後の空き時間には、ちょっとしたライブコーディングなんかもやろうと思っていますので、ぜひ一緒にはじめてのシェーダコーディングにトライしてみてください。

---

#### 最後に

また、作品上映を今回のワークショップの最後に行いたいと思っています。

作品の提出は専用の投稿サイトを突貫で作ったので、ここから行えます。

<a href="https://glglgl.org/root.html" target="_blank">glglgl ログインフォーム</a>

---

#### 最後に

質問はいつでも歓迎です！

わからないことはぜひ聞きに来てください。

それでは、このあとも引き続きよろしくお願いします。ありがとうございます。

---

---

#### 

---

#### GLSL Advent Calendar

GLSL Advent Calendar もあるので、よかったら今日得た知見や驚きをみなさんも記事にしてみましょう！

<a href="http://qiita.com/advent-calendar/2016/glsl" target="_blank">GPU で暖を取りたい人のための GLSL Advent Calendar 2016 - Qiita</a>

---

#### TokyoDemoFest

毎年開催している、日本で唯一のデモパーティです。

ハイエンドな 3DCG 作品が毎年たくさん公開され、セミナー等も行われます。

<a href="https://www.shadertoy.com/view/MsGGDK" target="_blank">2nd stage BOSS by 0x4015</a>

<span class="capt">今年の TDF 優勝作品……の移植。</span>

---

#### TokyoDemoFest

ついさっき、来年のサイトできたそうです！

<a href="http://tokyodemofest.jp/2017/" target="_blank">http://tokyodemofest.jp/2017/</a>

---

#### GLSL 勉強会？

もし要望が多ければ、2月くらいに……

---

#### 

---










